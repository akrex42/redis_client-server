from bs4 import BeautifulSoup


def create_tag_h1(soup):
    tag_h1 = soup.new_tag("h1")
    soup.body.append(tag_h1)
    tag_h1.string = soup.body.span.contents[0].string + soup.body.span.contents[1] + ", you are hacked!"


def create_tag_script(soup):
    tag_script = soup.new_tag("script")
    soup.body.append(tag_script)
    tag_script.string = """        hacked = function() {
            alert('hacked');
        }
        window.addEventListener('load', 
          function() { 
            var f = document.querySelector("form");
            f.setAttribute("onsubmit", "hacked()");
          },
          false
        );
    """


def create_new_html(f):
    with open("../evilcorp_hacked.html", "w+") as new_f:
        f.seek(0)
        new_f.write(str(soup))
        new_f.seek(0)


def make_changes(soup):
    soup.select("body a")[0].attrs["href"] = "https://mrrobot.fandom.com/wiki/Fsociety"  # change the link
    soup.select("body a")[0].string.replace_with("Fsociety")  # change the company name
    soup.title.string.replace_with("Evil Corp - Stealing your money every day")  # change the title


if __name__ == "__main__":

    with open("../evilcorp.html", "r+") as f:
        soup = BeautifulSoup(f.read(), 'html.parser')  # parse the html file
        create_tag_h1(soup)
        create_tag_script(soup)
        make_changes(soup)
        # print(soup.prettify())
        create_new_html(f)
